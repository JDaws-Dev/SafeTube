# SafeTube - YouTube Parental Control App

## Project Overview
SafeTube is a YouTube parental control app that lets parents create whitelists of approved YouTube channels and videos for their kids. Kids can ONLY watch content that parents have explicitly approved.

## Technology Stack
- **Frontend**: React 19, Vite, Tailwind CSS
- **Backend**: Convex (real-time database)
- **Authentication**: Better Auth (@convex-dev/better-auth)
- **Video Playback**: YouTube IFrame Player API (TOS-compliant)
- **Video Metadata**: YouTube Data API v3
- **Routing**: React Router v7

## Project Structure

```
SafeTube/
├── convex/                    # Backend (Convex functions)
│   ├── schema.ts              # Database schema
│   ├── auth.ts                # Better Auth setup
│   ├── users.ts               # User management, family codes
│   ├── kidProfiles.ts         # Kid profile CRUD
│   ├── channels.ts            # Approved channels management
│   └── videos.ts              # Approved videos management
├── src/
│   ├── pages/                 # Route pages
│   │   ├── LandingPage.jsx    # Marketing landing page
│   │   ├── LoginPage.jsx      # Parent login
│   │   ├── SignupPage.jsx     # Parent signup
│   │   ├── AdminDashboard.jsx # Parent control panel
│   │   └── KidPlayer.jsx      # Kid entry point
│   ├── components/
│   │   ├── admin/             # Parent dashboard components
│   │   │   ├── KidProfilesManager.jsx
│   │   │   ├── YouTubeSearch.jsx
│   │   │   └── ContentLibrary.jsx
│   │   └── kid/               # Kid player components
│   │       ├── ProfileSelector.jsx
│   │       ├── KidHome.jsx
│   │       └── VideoPlayer.jsx
│   ├── lib/
│   │   └── auth-client.js     # Better Auth client
│   └── config/
│       └── youtube.js         # YouTube API integration
├── public/                    # Static assets
│   ├── favicon.svg            # App favicon
│   └── logo.svg               # App logo
└── .env.example               # Environment variables template
```

## Database Schema

### Tables

**users** - Parent accounts
- `betterAuthId`: Auth system ID
- `email`, `name`: User info
- `familyCode`: 6-character code for kids to access content
- `parentPin`: Optional PIN for parent mode protection

**kidProfiles** - Individual kid profiles
- `userId`: Parent user reference
- `name`, `icon`, `color`: Profile customization

**approvedChannels** - Whitelisted YouTube channels
- `kidProfileId`: Which kid can access
- `channelId`, `channelTitle`, `thumbnailUrl`: Channel info
- Videos are fetched LIVE from YouTube when kid browses (not stored)

**approvedVideos** - Whitelisted individual videos (one-offs)
- `kidProfileId`: Which kid can access
- `videoId`, `title`, `thumbnailUrl`, `channelId`, `channelTitle`: Video info
- `durationSeconds`: Video length

**watchHistory** - Viewing history
- `kidProfileId`, `videoId`: What was watched
- `watchedAt`: Timestamp

## Key Features

### Parent Features
1. **YouTube Search**: Search channels and videos directly
2. **Channel Whitelist**: Add channels - all videos automatically approved
3. **Individual Videos**: Add single videos from non-whitelisted channels
4. **Per-Kid Whitelists**: Each kid has their own approved content
5. **Family Code**: Share code with kids to access their content
6. **Content Library**: View and manage approved content

### Kid Features
1. **Profile Selection**: Kids pick their profile
2. **Browse Channels**: See approved channels with live video fetching
3. **Search Within Channels**: Find specific videos in whitelisted channels
4. **Search Videos**: Search individually approved videos
5. **Video Player**: Full-screen YouTube player with always-visible back button

## Recent Updates (December 2025)

### Channel Videos Now Fetched Live
- Adding a channel NO LONGER stores all videos in database
- Videos are fetched live from YouTube API when kid clicks on channel
- Benefits: Instant channel adding, new uploads automatically available, smaller database
- Kid can search within channel's videos (up to 500 videos fetched)

### UI Improvements
- Renamed from "SafeTubes" to "SafeTube" (mimics YouTube)
- Light theme with red/orange gradients
- Custom Toast notifications (replaced native alerts)
- Custom ConfirmModal (replaced native confirm dialogs)
- SVG icons replaced emojis throughout
- Always-visible back button in video player (mobile-friendly)
- `referrerPolicy="no-referrer"` on all YouTube thumbnails

### Architecture
- **Whitelisted channels**: Store channel info only, fetch videos live
- **Individual videos**: Store in `approvedVideos` table
- **Global search**: Searches individually approved videos
- **Channel search**: Searches live-fetched videos from that channel

## Environment Variables

```bash
# YouTube Data API Key (required for search)
VITE_YOUTUBE_API_KEY=your_key_here

# Convex URL (auto-generated by `npx convex dev`)
VITE_CONVEX_URL=https://your-deployment.convex.cloud
```

## Getting Started

```bash
# Install dependencies
npm install

# Start Convex backend (in one terminal)
npx convex dev

# Start frontend (in another terminal)
npm run dev
```

## YouTube API Setup

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project or select existing
3. Enable "YouTube Data API v3"
4. Create an API key in Credentials
5. Add the key to your `.env` file

## User Flows

### Parent Flow
1. Sign up / Log in
2. Create kid profiles
3. Search YouTube for channels or videos
4. Add channels (all videos approved) or individual videos
5. Share family code with kids

### Kid Flow
1. Go to `/play` or use family code URL
2. Enter family code
3. Select their profile
4. Browse channels or videos
5. Click channel → loads videos live → search within channel
6. Watch approved content

## Security Considerations

- Kids can ONLY access content explicitly approved by parents
- No YouTube recommendations or related videos shown
- No direct access to YouTube search (kids search approved content only)
- Family codes are simple but can be changed by parents
- Optional parent PIN for dashboard access

## API Rate Limits

YouTube Data API v3 has a daily quota of 10,000 units:
- Search: 100 units per request
- Video details: 1 unit per request
- Channel details: 1 unit per request
- PlaylistItems (channel videos): 1 unit per request

Channel video fetching uses pagination (up to 500 videos = ~10 API calls).

## Future Enhancements

### MVP (Current)
- [x] Channel whitelisting with live video fetching
- [x] Individual video whitelisting
- [x] Search within channels
- [x] Custom UI modals (no native dialogs)

### V2 - Screen Time API Integration
- [ ] Apply for `com.apple.developer.family-controls` entitlement
- [ ] Auto-block YouTube app when SafeTube is installed
- [ ] Block youtube.com in Safari/Chrome
- [ ] Prevent SafeTube app deletion without parent approval
- [ ] Watch time limits per kid

### V3 - Additional Features
- [ ] Screen time scheduling
- [ ] Watch history for parents
- [ ] Multiple devices support
- [ ] Push notifications for requests
- [ ] Age-appropriate content filtering
